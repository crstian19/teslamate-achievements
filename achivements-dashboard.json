{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 59,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PC98BA2F4D77E1A42"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "dark-red",
                  "index": 0,
                  "text": "‚ùå"
                },
                "1": {
                  "color": "dark-green",
                  "index": 1,
                  "text": "üèÜ"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PC98BA2F4D77E1A42"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "-- 1. HYPERMILER\nSELECT 'üèÖ Hypermiler' AS \"Achievement\", 'Drive >50km with >100% efficiency vs rated range' AS \"Mission\",\nCASE WHEN EXISTS (\n    SELECT 1 FROM drives WHERE car_id = 1 AND distance > 50 \n    AND (start_rated_range_km - end_rated_range_km) > 0\n    AND distance > (start_rated_range_km - end_rated_range_km)\n) THEN 1 ELSE 0 END AS \"Status\"\n\nUNION ALL\n\n-- 2. SUPERCHARGER JUNKIE\nSELECT '‚ö° Supercharger Junkie', 'Fast charge at speeds over 120 kW',\nCASE WHEN EXISTS (\n    SELECT 1 FROM charges c JOIN charging_processes cp ON cp.id = c.charging_process_id\n    WHERE cp.car_id = 1 AND c.charger_power > 120\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 3. LIVING ON THE EDGE\nSELECT '‚ö†Ô∏è Living on the Edge', 'Finish a drive with less than 5% battery',\nCASE WHEN EXISTS (\n    SELECT 1 FROM drives d JOIN positions p ON p.id = d.end_position_id\n    WHERE d.car_id = 1 AND p.battery_level < 5\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 4. EFFICIENCY MASTER\nSELECT 'üçÉ Efficiency Master', 'Efficiency >100% vs Rated (7-day streak)',\nCASE WHEN EXISTS (\n    SELECT 1 FROM (\n        SELECT avg(distance / NULLIF(start_rated_range_km - end_rated_range_km, 0)) OVER (ORDER BY start_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as eff\n        FROM drives WHERE car_id=1 AND distance > 10\n    ) sub WHERE eff >= 1.0\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 5. EFFICIENCY EXPERT\nSELECT 'üåø Efficiency Expert', 'Efficiency >110% vs Rated (7-day streak)',\nCASE WHEN EXISTS (\n    SELECT 1 FROM (\n        SELECT avg(distance / NULLIF(start_rated_range_km - end_rated_range_km, 0)) OVER (ORDER BY start_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as eff\n        FROM drives WHERE car_id=1 AND distance > 10\n    ) sub WHERE eff >= 1.1\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 6. EFFICIENCY GURU\nSELECT 'üßò Efficiency Guru', 'Efficiency >120% vs Rated (7-day streak)',\nCASE WHEN EXISTS (\n    SELECT 1 FROM (\n        SELECT avg(distance / NULLIF(start_rated_range_km - end_rated_range_km, 0)) OVER (ORDER BY start_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as eff\n        FROM drives WHERE car_id=1 AND distance > 10\n    ) sub WHERE eff >= 1.2\n) THEN 1 ELSE 0 END;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "üåø Efficiency & Energy",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PC98BA2F4D77E1A42"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "dark-red",
                  "index": 0,
                  "text": "‚ùå"
                },
                "1": {
                  "color": "dark-green",
                  "index": 1,
                  "text": "üèÜ"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 8
      },
      "id": 2,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PC98BA2F4D77E1A42"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "-- 1. LOCAL EXPLORER\nSELECT 'üèôÔ∏è Local Explorer' AS \"Achievement\", 'Visit 5 different cities' AS \"Mission\",\nCASE WHEN (\n    SELECT count(distinct city) FROM addresses a JOIN drives d ON d.end_address_id = a.id WHERE d.car_id=1\n) >= 5 THEN 1 ELSE 0 END AS \"Status\"\n\nUNION ALL\n\n-- 2. REGIONAL EXPLORER\nSELECT 'üó∫Ô∏è Regional Explorer', 'Visit 10 different regions/counties',\nCASE WHEN (\n    SELECT count(distinct county) FROM addresses a JOIN drives d ON d.end_address_id = a.id WHERE d.car_id=1\n) >= 10 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 3. NATIONAL EXPLORER\nSELECT 'üá™üá∏ National Explorer', 'Visit 15 different States/Provinces',\nCASE WHEN (\n    SELECT count(distinct state) FROM addresses a JOIN drives d ON d.end_address_id = a.id WHERE d.car_id=1\n) >= 15 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 4. ADVENTURER\nSELECT 'üéí Adventurer', 'Travel more than 300 km from home',\nCASE WHEN EXISTS (\n    SELECT 1 FROM positions p, geofences g\n    WHERE p.car_id=1 AND (g.name ILIKE '%Home%' OR g.name ILIKE '%Casa%')\n    AND (6371 * acos(cos(radians(g.latitude)) * cos(radians(p.latitude)) * cos(radians(p.longitude) - radians(g.longitude)) + sin(radians(g.latitude)) * sin(radians(p.latitude)))) > 300\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 5. GLOBETROTTER\nSELECT 'üåç Globetrotter', 'Travel more than 500 km from home',\nCASE WHEN EXISTS (\n    SELECT 1 FROM positions p, geofences g\n    WHERE p.car_id=1 AND (g.name ILIKE '%Home%' OR g.name ILIKE '%Casa%')\n    AND (6371 * acos(cos(radians(g.latitude)) * cos(radians(p.latitude)) * cos(radians(p.longitude) - radians(g.longitude)) + sin(radians(g.latitude)) * sin(radians(p.latitude)))) > 500\n) THEN 1 ELSE 0 END;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "üåç Exploration & Geography",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PC98BA2F4D77E1A42"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "dark-red",
                  "index": 0,
                  "text": "‚ùå"
                },
                "1": {
                  "color": "dark-green",
                  "index": 1,
                  "text": "üèÜ"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 16
      },
      "id": 3,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PC98BA2F4D77E1A42"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "-- 1. SUB-ZERO\nSELECT '‚ùÑÔ∏è Sub-Zero' AS \"Achievement\", 'Charge while outside temp is below 0¬∞C' AS \"Mission\",\nCASE WHEN EXISTS (\n    SELECT 1 FROM charging_processes cp JOIN positions p ON p.id = cp.position_id\n    WHERE cp.car_id = 1 AND p.outside_temp < 0\n) THEN 1 ELSE 0 END AS \"Status\"\n\nUNION ALL\n\n-- 2. NIGHT RIDER\nSELECT 'ü¶á Night Rider', 'Complete a drive between 02:00 AM and 05:00 AM',\nCASE WHEN EXISTS (\n    SELECT 1 FROM drives WHERE car_id = 1 AND EXTRACT(HOUR FROM start_date) BETWEEN 2 AND 4\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 3. NIGHT OWL\nSELECT 'üåô Night Owl', 'Accumulate >100 km at night (00:00-06:00)',\nCASE WHEN (\n    SELECT sum(distance) FROM drives WHERE car_id=1 AND EXTRACT(HOUR FROM start_date) BETWEEN 0 AND 5\n) > 100 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 4. MIDNIGHT WARRIOR\nSELECT 'ü¶â Midnight Warrior', 'Accumulate >500 km at night (00:00-06:00)',\nCASE WHEN (\n    SELECT sum(distance) FROM drives WHERE car_id=1 AND EXTRACT(HOUR FROM start_date) BETWEEN 0 AND 5\n) > 500 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 5. EARLY BIRD\nSELECT 'üåÖ Early Bird', 'Start 10 charging sessions before 7:00 AM',\nCASE WHEN (\n    SELECT count(*) FROM charging_processes WHERE car_id=1 AND EXTRACT(HOUR FROM start_date) < 7\n) >= 10 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 6. RISE AND SHINE\nSELECT 'üêì Rise and Shine', 'Start 50 charging sessions before 7:00 AM',\nCASE WHEN (\n    SELECT count(*) FROM charging_processes WHERE car_id=1 AND EXTRACT(HOUR FROM start_date) < 7\n) >= 50 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 7. VETERAN\nSELECT 'üìÖ Veteran', 'Data collected for more than 1 year',\nCASE WHEN (NOW() - (SELECT min(start_date) FROM drives WHERE car_id = 1)) > INTERVAL '1 year'\nTHEN 1 ELSE 0 END;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "‚è±Ô∏è Time & Weather",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PC98BA2F4D77E1A42"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "dark-red",
                  "index": 0,
                  "text": "‚ùå"
                },
                "1": {
                  "color": "dark-green",
                  "index": 1,
                  "text": "üèÜ"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 26
      },
      "id": 4,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PC98BA2F4D77E1A42"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "-- 1. IRON BUTT (Distance is safe to use from drives)\nSELECT 'üçë Iron Butt' AS \"Achievement\", 'Drive >400km in a single trip' AS \"Mission\",\nCASE WHEN (SELECT max(distance) FROM drives WHERE car_id = 1) > 400 THEN 1 ELSE 0 END AS \"Status\"\n\nUNION ALL\n\n-- 2. TOTAL MARATHONER\nSELECT 'üèÉ Total Marathoner', 'Accumulate >10,000 km total distance',\nCASE WHEN (SELECT sum(distance) FROM drives WHERE car_id = 1) > 10000 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 3. DAILY MARATHONER\nSELECT 'üëü Daily Marathoner', 'Drive >500 km in a single day',\nCASE WHEN EXISTS (\n    SELECT 1 FROM drives WHERE car_id=1 GROUP BY start_date::date HAVING sum(distance) > 500\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 4. ULTRA MARATHONER\nSELECT 'ü¶æ Ultra Marathoner', 'Drive >800 km in a single day',\nCASE WHEN EXISTS (\n    SELECT 1 FROM drives WHERE car_id=1 GROUP BY start_date::date HAVING sum(distance) > 800\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 5. SPEEDSTER (Direct lookup in positions table - correct)\nSELECT 'üöÄ Speedster', 'Reach a top speed >180 km/h',\nCASE WHEN EXISTS (\n    SELECT 1 FROM positions WHERE car_id=1 AND speed > 180\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 6. SMOOTH OPERATOR (FIXED: Looking at positions instead of drives)\nSELECT 'üßò Smooth Operator', '1,000 km streak without exceeding 120 km/h',\nCASE WHEN (\n    WITH LastSpeedingEvent AS (\n        -- Buscamos la √∫ltima vez exacta que el coche pas√≥ de 120 km/h en la tabla de posiciones\n        SELECT max(date) as last_speeding_time\n        FROM positions\n        WHERE car_id = 1 AND speed > 120\n    )\n    -- Sumamos la distancia de todos los viajes que empezaron DESPU√âS de ese momento\n    SELECT sum(distance)\n    FROM drives\n    WHERE car_id = 1\n    AND start_date > COALESCE((SELECT last_speeding_time FROM LastSpeedingEvent), '2000-01-01')\n) > 1000 THEN 1 ELSE 0 END;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "üèéÔ∏è Endurance & Performance",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PC98BA2F4D77E1A42"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "dark-red",
                  "index": 0,
                  "text": "‚ùå"
                },
                "1": {
                  "color": "dark-green",
                  "index": 1,
                  "text": "üèÜ"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 35
      },
      "id": 5,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PC98BA2F4D77E1A42"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "-- 1. FIRST SPARK (Desbloqueado)\nSELECT 'üîì First Spark' AS \"Achievement\", 'First time data recorded' AS \"Mission\",\nCASE WHEN (SELECT count(*) FROM drives WHERE car_id = 1) > 0 THEN 1 ELSE 0 END AS \"Status\"\n\nUNION ALL\n\n-- 2. BOUNTY HUNTER (Cazador de Gratis - 100 kWh)\nSELECT 'üÜì Bounty Hunter', 'Charge 100 kWh for free (0 cost recorded)',\nCASE WHEN (\n    SELECT sum(charge_energy_added) FROM charging_processes \n    WHERE car_id = 1 AND (cost = 0 OR cost IS NULL)\n) >= 100 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 3. FREELOADER (Aprovechado - 1000 kWh)\nSELECT 'üè¥‚Äç‚ò†Ô∏è Freeloader', 'Charge 1,000 kWh for free',\nCASE WHEN (\n    SELECT sum(charge_energy_added) FROM charging_processes \n    WHERE car_id = 1 AND (cost = 0 OR cost IS NULL)\n) >= 1000 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 4. NIGHT PLANNER (Planificador Nocturno)\nSELECT 'üåô Night Planner', 'Complete 50 charging sessions off-peak (00:00-08:00)',\nCASE WHEN (\n    SELECT count(*) FROM charging_processes \n    WHERE car_id = 1 AND EXTRACT(HOUR FROM start_date) BETWEEN 0 AND 8\n) >= 50 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 5. THRIFTY (Ahorrativo - Estimado)\n-- F√≥rmula: Km Totales * 0.10‚Ç¨ de ahorro medio - Coste real de cargas\nSELECT 'üêñ Thrifty', 'Save estimated >500‚Ç¨ vs Gas',\nCASE WHEN (\n    SELECT (sum(distance)*0.10) - (SELECT sum(coalesce(cost,0)) FROM charging_processes WHERE car_id=1)\n    FROM drives WHERE car_id = 1\n) > 500 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 6. GREEN TYCOON (Millonario Verde - Estimado)\nSELECT 'ü§ë Green Tycoon', 'Save estimated >1,000‚Ç¨ vs Gas',\nCASE WHEN (\n    SELECT (sum(distance)*0.10) - (SELECT sum(coalesce(cost,0)) FROM charging_processes WHERE car_id=1)\n    FROM drives WHERE car_id = 1\n) > 1000 THEN 1 ELSE 0 END;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "üí∞ Savings & Charging Habits",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PC98BA2F4D77E1A42"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "dark-red",
                  "index": 0,
                  "text": "‚ùå"
                },
                "1": {
                  "color": "dark-green",
                  "index": 1,
                  "text": "üèÜ"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 44
      },
      "id": 6,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PC98BA2F4D77E1A42"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "-- 1. PATIENT LVL 1\nSELECT 'üßò Patient Lvl 1' AS \"Achievement\", 'Spent 10 hours charging total' AS \"Mission\",\nCASE WHEN (\n    SELECT sum(duration_min) FROM charging_processes WHERE car_id = 1\n) >= 600 THEN 1 ELSE 0 END AS \"Status\"\n\nUNION ALL\n\n-- 2. PATIENT LVL 2\nSELECT 'üßò Patient Lvl 2', 'Spent 50 hours charging total',\nCASE WHEN (\n    SELECT sum(duration_min) FROM charging_processes WHERE car_id = 1\n) >= 3000 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 3. PATIENT LVL 3\nSELECT 'üßò Patient Lvl 3', 'Spent 100 hours charging total',\nCASE WHEN (\n    SELECT sum(duration_min) FROM charging_processes WHERE car_id = 1\n) >= 6000 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 4. AC DEVOTEE (Calculated: Avg Power < 22kW)\n-- Fix: We calculate (kWh / Hours). If avg power is < 22kW, it's likely AC.\nSELECT 'üîå AC Devotee', '80% of charging sessions are AC (Slow)',\nCASE WHEN (\n    SELECT \n        count(*) FILTER (WHERE (charge_energy_added / NULLIF(duration_min/60.0, 0)) < 22)::float \n        / NULLIF(count(*)::float, 0)\n    FROM charging_processes WHERE car_id = 1 AND duration_min > 0\n) >= 0.8 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 5. FAST CHARGE PRO (Calculated: Avg Power > 50kW)\n-- Fix: We calculate (kWh / Hours). If avg power > 50kW, it's definitely DC/Supercharger.\nSELECT '‚ö° Fast Charge Pro', 'Complete 100 Supercharger sessions (>50kW)',\nCASE WHEN (\n    SELECT count(*) \n    FROM charging_processes \n    WHERE car_id = 1 \n    AND duration_min > 0\n    AND (charge_energy_added / NULLIF(duration_min/60.0, 0)) > 50\n) >= 100 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 6. FULL CYCLE\nSELECT 'üîã Full Cycle', 'Charge from <10% to >95%',\nCASE WHEN EXISTS (\n    SELECT 1 FROM charging_processes \n    WHERE car_id = 1 \n    AND start_battery_level < 10 \n    AND end_battery_level > 95\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 7. THE OPTIMIZER\nSELECT 'üìê The Optimizer', 'Finish 100 charges between 80-90% SoC',\nCASE WHEN (\n    SELECT count(*) FROM charging_processes \n    WHERE car_id = 1 AND end_battery_level BETWEEN 80 AND 90\n) >= 100 THEN 1 ELSE 0 END\n",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "üîã Battery Tech & Strategy",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PC98BA2F4D77E1A42"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "dark-red",
                  "index": 0,
                  "text": "‚ùå"
                },
                "1": {
                  "color": "dark-green",
                  "index": 1,
                  "text": "üèÜ"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 24,
        "x": 0,
        "y": 53
      },
      "id": 7,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PC98BA2F4D77E1A42"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "-- 1. PLANET GUARDIAN (1000 kg CO2)\nSELECT 'üõ°Ô∏è Planet Guardian' AS \"Achievement\", 'Save 1,000 kg of CO2 vs ICE car' AS \"Mission\",\nCASE WHEN (\n    SELECT sum(distance) * 0.12 FROM drives WHERE car_id = 1\n) >= 1000 THEN 1 ELSE 0 END AS \"Status\"\n\nUNION ALL\n\n-- 2. CLIMATE HERO (5000 kg CO2)\nSELECT 'ü¶∏ Climate Hero', 'Save 5,000 kg of CO2 vs ICE car',\nCASE WHEN (\n    SELECT sum(distance) * 0.12 FROM drives WHERE car_id = 1\n) >= 5000 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 3. PERSONAL FOREST (50 Trees)\n-- Logic: 50 trees * 22kg CO2/tree = 1,100 kg CO2 saved\nSELECT 'üå≥ Personal Forest', 'Save CO2 equivalent to planting 50 trees',\nCASE WHEN (\n    SELECT sum(distance) * 0.12 FROM drives WHERE car_id = 1\n) >= (50 * 22) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 4. AMAZON RAINFOREST (200 Trees)\n-- Logic: 200 trees * 22kg CO2/tree = 4,400 kg CO2 saved\nSELECT 'ü¶ú Amazon Rainforest', 'Save CO2 equivalent to planting 200 trees',\nCASE WHEN (\n    SELECT sum(distance) * 0.12 FROM drives WHERE car_id = 1\n) >= (200 * 22) THEN 1 ELSE 0 END;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "üåø Ecology & Impact",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PC98BA2F4D77E1A42"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "dark-red",
                  "index": 0,
                  "text": "‚ùå"
                },
                "1": {
                  "color": "dark-green",
                  "index": 1,
                  "text": "üèÜ"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 24,
        "x": 0,
        "y": 60
      },
      "id": 8,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PC98BA2F4D77E1A42"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "-- 1. AROUND THE WORLD (Circunferencia Tierra)\nSELECT 'üåç Around the World' AS \"Achievement\", 'Drive 40,075 km (Earth Circumference)' AS \"Mission\",\nCASE WHEN (\n    SELECT sum(distance) FROM drives WHERE car_id = 1\n) >= 40075 THEN 1 ELSE 0 END AS \"Status\"\n\nUNION ALL\n\n-- 2. ISS ORBITER (Orbita ISS)\n-- Distancia de una √≥rbita completa de la ISS (~42,500 km)\nSELECT 'üõ∞Ô∏è ISS Orbiter', 'Drive 42,500 km (One ISS Orbit distance)',\nCASE WHEN (\n    SELECT sum(distance) FROM drives WHERE car_id = 1\n) >= 42500 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 3. TO THE MOON (Distancia Luna)\nSELECT 'üöÄ To the Moon', 'Drive 384,400 km (Earth to Moon distance)',\nCASE WHEN (\n    SELECT sum(distance) FROM drives WHERE car_id = 1\n) >= 384400 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 4. 24H LE MANS (D√≠as de Vida - 24h)\nSELECT 'üèéÔ∏è 24h Le Mans', 'Spend 24 total hours driving',\nCASE WHEN (\n    SELECT sum(duration_min) FROM drives WHERE car_id = 1\n) >= (24 * 60) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 5. ROAD TOURIST (Turista - 100h)\nSELECT 'üì∏ Road Tourist', 'Spend 100 total hours driving',\nCASE WHEN (\n    SELECT sum(duration_min) FROM drives WHERE car_id = 1\n) >= (100 * 60) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 6. A WEEK ON THE ROAD (Semana de Vida - 168h)\nSELECT 'üìÖ A Week on the Road', 'Spend 168 total hours (1 week) driving',\nCASE WHEN (\n    SELECT sum(duration_min) FROM drives WHERE car_id = 1\n) >= (168 * 60) THEN 1 ELSE 0 END;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "üöÄ Space & Time Continuum",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "PC98BA2F4D77E1A42"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [
            {
              "options": {
                "0": {
                  "color": "dark-red",
                  "index": 0,
                  "text": "‚ùå"
                },
                "1": {
                  "color": "dark-green",
                  "index": 1,
                  "text": "üèÜ"
                }
              },
              "type": "value"
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 12,
        "w": 24,
        "x": 0,
        "y": 69
      },
      "id": 9,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.1.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "PC98BA2F4D77E1A42"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "-- 1. ACTIVE STREAK 7 (Calculated using Gaps-and-Islands method)\nSELECT 'üî• Daily Driver (7 Days)' AS \"Achievement\", 'Drive 7 consecutive days' AS \"Mission\",\nCASE WHEN (\n    WITH Dates AS (SELECT DISTINCT start_date::date as d FROM drives WHERE car_id=1),\n    Groups AS (SELECT d, d - (ROW_NUMBER() OVER (ORDER BY d) * interval '1 day') as grp FROM Dates),\n    Streaks AS (SELECT count(*) as days FROM Groups GROUP BY grp)\n    SELECT max(days) FROM Streaks\n) >= 7 THEN 1 ELSE 0 END AS \"Status\"\n\nUNION ALL\n\n-- 2. ACTIVE STREAK 30\nSELECT 'üî• Daily Driver (30 Days)', 'Drive 30 consecutive days',\nCASE WHEN (\n    WITH Dates AS (SELECT DISTINCT start_date::date as d FROM drives WHERE car_id=1),\n    Groups AS (SELECT d, d - (ROW_NUMBER() OVER (ORDER BY d) * interval '1 day') as grp FROM Dates),\n    Streaks AS (SELECT count(*) as days FROM Groups GROUP BY grp)\n    SELECT max(days) FROM Streaks\n) >= 30 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 3. ACTIVE STREAK 100\nSELECT 'üî• Daily Driver (100 Days)', 'Drive 100 consecutive days',\nCASE WHEN (\n    WITH Dates AS (SELECT DISTINCT start_date::date as d FROM drives WHERE car_id=1),\n    Groups AS (SELECT d, d - (ROW_NUMBER() OVER (ORDER BY d) * interval '1 day') as grp FROM Dates),\n    Streaks AS (SELECT count(*) as days FROM Groups GROUP BY grp)\n    SELECT max(days) FROM Streaks\n) >= 100 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 4. WEEKENDER (>60% Weekend)\n-- Logic: (Weekend Distance / Total Distance) > 0.6\nSELECT 'üèñÔ∏è Weekender', '60% of driving done on weekends',\nCASE WHEN (\n    SELECT sum(distance) FILTER (WHERE EXTRACT(ISODOW FROM start_date) IN (6,7)) \n           / NULLIF(sum(distance), 0)\n    FROM drives WHERE car_id=1\n) > 0.6 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 5. WORKAHOLIC (>60% Weekdays)\n-- Logic: (Weekday Distance / Total Distance) > 0.6\nSELECT 'üíº Workaholic', '60% of driving done on weekdays (Mon-Fri)',\nCASE WHEN (\n    SELECT sum(distance) FILTER (WHERE EXTRACT(ISODOW FROM start_date) NOT IN (6,7)) \n           / NULLIF(sum(distance), 0)\n    FROM drives WHERE car_id=1\n) > 0.6 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 6. INFERNO RIDER (>40¬∞C)\nSELECT 'üî• Inferno Rider', 'Drive in temperatures > 40¬∞C',\nCASE WHEN EXISTS (\n    SELECT 1 FROM positions WHERE car_id=1 AND outside_temp > 40\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 7. ICE ROAD TRUCKER (<-10¬∞C)\nSELECT '‚ùÑÔ∏è Ice Road Trucker', 'Drive in temperatures < -10¬∞C',\nCASE WHEN EXISTS (\n    SELECT 1 FROM positions WHERE car_id=1 AND outside_temp < -10\n) THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 8. MOUNTAINEER (10k meters elevation gain)\n-- Logic: Sum of (End Elevation - Start Elevation) for all trips that went UP.\nSELECT '‚õ∞Ô∏è Mountaineer', 'Climb 10,000m cumulative elevation',\nCASE WHEN (\n    SELECT sum(p_end.elevation - p_start.elevation)\n    FROM drives d\n    JOIN positions p_start ON d.start_position_id = p_start.id\n    JOIN positions p_end ON d.end_position_id = p_end.id\n    WHERE d.car_id = 1 AND p_end.elevation > p_start.elevation\n) >= 10000 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 9. ALPINIST (50k meters)\nSELECT 'üßó Alpinist', 'Climb 50,000m cumulative elevation',\nCASE WHEN (\n    SELECT sum(p_end.elevation - p_start.elevation)\n    FROM drives d\n    JOIN positions p_start ON d.start_position_id = p_start.id\n    JOIN positions p_end ON d.end_position_id = p_end.id\n    WHERE d.car_id = 1 AND p_end.elevation > p_start.elevation\n) >= 50000 THEN 1 ELSE 0 END\n\nUNION ALL\n\n-- 10. THE SHERPA (100k meters)\nSELECT 'üèîÔ∏è The Sherpa', 'Climb 100,000m cumulative elevation',\nCASE WHEN (\n    SELECT sum(p_end.elevation - p_start.elevation)\n    FROM drives d\n    JOIN positions p_start ON d.start_position_id = p_start.id\n    JOIN positions p_end ON d.end_position_id = p_end.id\n    WHERE d.car_id = 1 AND p_end.elevation > p_start.elevation\n) >= 100000 THEN 1 ELSE 0 END;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "üèîÔ∏è Habits & Extremes",
      "type": "table"
    }
  ],
  "preload": false,
  "schemaVersion": 41,
  "tags": [],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-1y",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "Achievements",
  "uid": "c6020bdb-a2c7-4b1c-ab2c-fd34ab836c6e",
  "version": 11
}